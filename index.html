<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Malla Curricular Interactiva – Ingeniería Industrial UTN FRC</title>
  <style>
    /* ===== Estilos base pastel y suaves ===== */
    :root{
      --bg: #f8fafc;             /* gris azulado muy claro */
      --card: #ffffff;
      --ink: #1f2937;            /* gris oscuro */
      --muted: #6b7280;          /* gris medio */
      --accent: #93c5fd;         /* azul pastel */
      --accent-2: #a7f3d0;       /* verde menta claro */
      --pending: #e5e7eb;        /* gris claro para pendiente */
      --regular: #fde68a;        /* amarillo pastel */
      --approved: #86efac;       /* verde pastel */
      --blocked: #e2e8f0;        /* bloqueado */
      --badge: #fbcfe8;          /* rosa muy suave */
      --shadow: 0 8px 20px rgba(2, 6, 23, 0.06);
      --radius: 16px;
    }
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background: var(--bg); color: var(--ink);
    }
    header{
      position: sticky; top:0; z-index: 40;
      backdrop-filter: blur(6px);
      background: linear-gradient(to bottom, rgba(248,250,252,.9), rgba(248,250,252,.6));
      border-bottom: 1px solid #e5e7eb;
    }
    .wrap{ max-width: 1200px; margin: 0 auto; padding: 16px 20px; }
    h1{ margin:0; font-size: clamp(20px, 2vw + 8px, 28px); letter-spacing: .2px; }
    .sub{ color: var(--muted); font-size: 14px; margin-top: 6px; }

    /* ===== Panel de controles ===== */
    .controls{
      display:flex; flex-wrap: wrap; gap: 10px; margin-top: 12px;
    }
    .btn{
      border: 1px solid #e5e7eb; background: var(--card); color: var(--ink);
      padding: 10px 14px; border-radius: 12px; box-shadow: var(--shadow);
      cursor: pointer; transition: transform .06s ease, background .2s ease; font-weight:600; font-size: 14px;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn.secondary{ background: #eef2ff; border-color:#e0e7ff; }
    .btn.danger{ background:#fee2e2; border-color:#fecaca; }
    .btn.icon{ display:inline-flex; align-items:center; gap:8px; }
    .spacer{ flex: 1 1 20px; }

    /* ===== Grid de años/semestres ===== */
    .grid{ display:grid; grid-template-columns: repeat(6, 1fr); gap: 16px; padding: 18px 20px 40px; max-width: 1200px; margin: 0 auto; }
    .col{ background: var(--card); border: 1px solid #e5e7eb; border-radius: var(--radius); box-shadow: var(--shadow); display:flex; flex-direction: column; }
    .col h2{
      font-size: 16px; margin: 0; padding: 14px 14px; border-bottom: 1px dashed #e5e7eb; display:flex; align-items:center; justify-content: space-between; gap: 8px;
    }
    .badge{ background: var(--badge); color:#7c3aed; font-weight:700; font-size: 11px; padding: 4px 8px; border-radius: 999px; }
    .list{ padding: 10px; display:flex; flex-direction: column; gap: 10px; }

    /* ===== Tarjeta de materia ===== */
    .card{
      position: relative;
      background: var(--card);
      border: 1px solid #e5e7eb;
      border-radius: 14px;
      padding: 10px 12px;
      display:flex; flex-direction: column; gap: 6px;
      box-shadow: var(--shadow);
      transition: filter .2s ease, transform .06s ease, background .2s ease;
      cursor: pointer;
    }
    .card:hover{ transform: translateY(-1px); }
    .title{ font-weight: 700; font-size: 14px; line-height: 1.2; }
    .meta{ display:flex; align-items:center; gap: 8px; font-size: 12px; color: var(--muted); }
    .mod{ background:#e0f2fe; color:#0369a1; padding:2px 8px; border-radius: 999px; font-weight:700; font-size: 11px; }
    .code{ background:#f1f5f9; color:#334155; padding:2px 8px; border-radius: 999px; font-weight:700; font-size: 11px; }

    /* Estados visuales */
    .state{ font-size: 11px; font-weight: 800; background:#f1f5f9; color:#334155; padding: 2px 8px; border-radius: 999px; margin-left:auto; }
    .card.pending{ background: var(--card); }
    .card.regular{ background: var(--regular); }
    .card.approved{ background: var(--approved); }
    .card.blocked{ background: var(--blocked); filter: grayscale(.3) brightness(.98); cursor: not-allowed; }

    /* Tooltip */
    .tooltip{ position: absolute; inset: auto auto 100% 0; transform: translateY(-8px); background: #0f172a; color: #fff; border-radius: 10px; padding: 10px 12px; box-shadow: var(--shadow); min-width: 220px; max-width: 320px; font-size: 12px; line-height: 1.25; display:none; }
    .tooltip::after{ content:""; position:absolute; bottom: -8px; left:12px; border-width: 8px 8px 0 8px; border-style: solid; border-color:#0f172a transparent transparent transparent; }
    .card.show-tip .tooltip{ display:block; }

    /* Responsivo */
    @media (max-width: 1100px){ .grid{ grid-template-columns: repeat(3, 1fr);} }
    @media (max-width: 720px){ .grid{ grid-template-columns: repeat(2, 1fr);} }
    @media (max-width: 520px){ .grid{ grid-template-columns: 1fr;} }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Malla Curricular Interactiva – Ingeniería Industrial (UTN FRC – Plan 2023)</h1>
      <p class="sub">Haz clic en cada materia para cambiar su estado: <strong>Pendiente → Regularizada → Aprobada</strong>. Las materias con requisitos aparecerán bloqueadas hasta cumplir las correlativas. Todo se guarda en tu navegador (LocalStorage).</p>
      <div class="controls">
        <button class="btn icon" id="btnExport" title="Exportar tus estados en JSON">
          ↗ Exportar
        </button>
        <label class="btn icon secondary" for="importFile" title="Importar un archivo JSON con tus estados">⬇ Importar
          <input id="importFile" type="file" accept="application/json" style="display:none" />
        </label>
        <div class="spacer"></div>
        <button class="btn danger" id="btnReset" title="Borrar todos los avances guardados">⟲ Resetear todo</button>
      </div>
    </div>
  </header>

  <main class="grid" id="grid"></main>

  <template id="tpl-col">
    <section class="col">
      <h2><span class="h-title"></span><span class="badge"></span></h2>
      <div class="list"></div>
    </section>
  </template>

  <template id="tpl-card">
    <article class="card pending" tabindex="0" aria-live="polite">
      <div class="title"></div>
      <div class="meta">
        <span class="code"></span>
        <span class="mod" title="Modalidad">A</span>
        <span class="state">Pendiente</span>
      </div>
      <div class="tooltip" role="tooltip"></div>
    </article>
  </template>

  <script>
  // ======================
  //   Datos de la Malla
  //   (Plan 2023 – UTN FRC)
  // ======================
  // Estados: 0 = pendiente, 1 = regularizada, 2 = aprobada
  // Regla de correlativas:
  //  - Para pasar de PENDIENTE→REGULAR: todas las "regular" requeridas deben estar >= REGULAR.
  //  - Para pasar de REGULAR→APROBADA: todas las "aprobada" requeridas deben estar = APROBADA.

  const COURSES = [
    // ==== 1er año ====
    c(1,  "Análisis Matemático I",                   1, "A"),
    c(2,  "Química General",                          1, "A"),
    c(3,  "Sistemas de Representación",              1, "A"),
    c(4,  "Informática I",                            1, "A"),
    c(5,  "Pensamiento Sistémico",                   1, "A"),
    c(6,  "Física I",                                 1, "A"),
    c(7,  "Álgebra y Geometría Analítica",           1, "A"),
    c(8,  "Ingeniería y Sociedad",                    1, "A"),

    // ==== 2do año ====
    c(9,  "Análisis Matemático II",                  2, "A",       {reg:[1,7]}),
    c(10, "Administración General",                   2, "A",       {reg:[4,5,7,8]}),
    c(11, "Probabilidad y Estadística",               2, "A",       {reg:[1,7]}),
    c(12, "Ciencias de los Materiales",               2, "A",       {reg:[2,6]}),
    c(13, "Física II",                                2, "A",       {reg:[1,6]}),
    c(14, "Economía General",                         2, "A",       {reg:[1,5,8]}),
    c(15, "Informática II",                           2, "A",       {reg:[4]}),
    c(16, "Inglés I",                                 2, "A"),

    // ==== 3er año ====
    c(17, "Costos y Presupuestos",                    3, "A",       {reg:[10,14], apr:[1,4,5,7,8]}),
    c(18, "Estudio del Trabajo",                       3, "A",       {reg:[3,10,11], apr:[1,3,4,5,7,8]}),
    c(19, "Comercialización",                         3, "A",       {reg:[10,11,14], apr:[1,4,5,7,8]}),
    c(20, "Termodinámica y Máquinas Térmicas",        3, "A",       {reg:[2,13], apr:[1,6]}),
    c(21, "Estática y Resistencia de los Materiales", 3, "A",       {reg:[9,12], apr:[1,2,6,7]}),
    c(22, "Mecánica de los Fluidos",                  3, "A",       {reg:[9], apr:[1,6,7]}),
    c(23, "Economía de la Empresa",                    3, "A",       {reg:[10,14], apr:[1,4,5,7,8]}),
    c(24, "Electrotecnia y Máquinas Eléctricas",      3, "A",       {reg:[13], apr:[1,6]}),
    c(25, "Análisis Numérico y Cálculo Avanzado",     3, "A",       {reg:[9], apr:[1,7]}),

    // ==== 4to año ====
    c(26, "Seguridad, Higiene e Ing. Ambiental",      4, "A",       {reg:[18], apr:[10,11]}),
    c(27, "Investigación Operativa",                  4, "A",       {reg:[9,11,25], apr:[1,7,25]}),
    c(28, "Procesos Industriales",                     4, "A",       {reg:[18,20,24], apr:[2,10,12,13]}),
    c(29, "Mecánica y Mecanismos",                     4, "A",       {reg:[9], apr:[1,6,7]}),
    c(30, "Evaluación de Proyectos",                   4, "A",       {reg:[17,18,19,23], apr:[10,11,14,16]}),
    c(31, "Planificación y Control de la Producción",  4, "A",       {reg:[18], apr:[10,11]}),
    c(32, "Diseño de Producto",                        4, "A",       {reg:[15,19], apr:[3,4,10,11,14]}),
    c(33, "Inglés II",                                 4, "A",       {reg:[16]}),
    c(34, "Instalaciones Industriales",                4, "A",       {reg:[20,21,22,24], apr:[2,9,12,13]}),
    c(35, "Legislación",                               4, "A",       {apr:[10]}),

    // ==== 5to año ====
    c(36, "Mantenimiento",                             5, "A",       {reg:[34], apr:[20,21,24]}),
    c(37, "Manejo de Materiales y Distribución de Planta",5, "A",   {reg:[18,29], apr:[9,10,21]}),
    c(38, "Comercio Exterior",                          5, "A",      {reg:[30], apr:[18,19,23]}),
    c(39, "Relaciones Industriales",                    5, "A",      {reg:[18], apr:[10,11]}),
    c(40, "Ingeniería en Calidad",                      5, "A",      {reg:[18], apr:[10,11]}),
    c(41, "Control de Gestión",                         5, "A",      {reg:[17,23], apr:[10,14]}),
    c(42, "Proyecto Final",                             5, "A",      {reg:[25,26,27,28,30,31], apr:[18,19,20,21,22,23,24,33]}),
  ];

  // Electivas (se muestran en una columna aparte). Se usan códigos desde 101 en adelante para no colisionar.
  const ELECTIVES = [
    e(101, "Gestión Ambiental (Electiva)",                         {reg:[26]}),
    e(102, "Gestión de Proyectos (Electiva)",                      {reg:[27,31,32], apr:[10,14,17,18]}),
    e(103, "Gestión Emprendedora (Electiva)",                      {reg:[30,31], apr:[10,17,19,23]}),
    e(104, "Logística (Electiva)",                                  {reg:[27,30,31], apr:[18,23]}),
    e(105, "Política Económica (Electiva)",                         {reg:[30], apr:[19,23]}),
    e(106, "Energías Renovables (Electiva)",                        {reg:[20,24,26,28,32], apr:[2]}),
    e(107, "Gestión del Conocimiento e Innovación (Electiva)",      {reg:[18,27], apr:[10,25]}),
    e(108, "Coaching de Formadores (Electiva)",                     {reg:[17,18,19], apr:[10,14]}),
    e(109, "Simulación (Electiva)",                                  {reg:[27,30,31,32], apr:[18]}),
    e(110, "Análisis de Datos I (Electiva)",                         {reg:[25,27], apr:[10,11,14,15,33]}),
    e(111, "Sustentabilidad y Nuevas Economías (Electiva)",         {reg:[17,18,19,30], apr:[10,14]}),
    e(112, "CNH Cátedra IN STU (Electiva)",                         {reg:[31,32,27], apr:[10,14,17,18,19]}),
  ];

  function c(code, name, year, mod, req={}){
    return { code, name, year, mod, reg:req.reg||[], apr:req.apr||[], elective:false };
  }
  function e(code, name, req={}){
    return { code, name, year: 6, mod: "1C/2C", reg:req.reg||[], apr:req.apr||[], elective:true };
  }

  // ============ Utilidades de almacenamiento ============
  const LS_KEY = 'utn-frc-industrial-plan-2023';
  let state = loadState(); // { [code]: 0|1|2 }

  function loadState(){
    try{ return JSON.parse(localStorage.getItem(LS_KEY)) || {}; }catch{ return {}; }
  }
  function saveState(){ localStorage.setItem(LS_KEY, JSON.stringify(state)); }

  // ============ Render del grid ============
  const grid = document.getElementById('grid');
  const columns = [
    { title: '1º Año', year:1, badge:'Anual (A)' },
    { title: '2º Año', year:2, badge:'Anual (A)' },
    { title: '3º Año', year:3, badge:'Anual (A)' },
    { title: '4º Año', year:4, badge:'Anual (A / 1C-2C)' },
    { title: '5º Año', year:5, badge:'Anual (A / 1C-2C)' },
    { title: 'Electivas', year:6, badge:'1C / 2C' },
  ];

  function render(){
    grid.innerHTML = '';
    const tplCol = document.getElementById('tpl-col');
    const tplCard = document.getElementById('tpl-card');

    for(const col of columns){
      const node = tplCol.content.cloneNode(true);
      node.querySelector('.h-title').textContent = col.title;
      node.querySelector('.badge').textContent = col.badge;
      const list = node.querySelector('.list');

      const items = (col.year===6 ? ELECTIVES : COURSES.filter(x=>x.year===col.year));
      items.forEach(item => list.appendChild(buildCard(tplCard, item)) );

      grid.appendChild(node);
    }
  }

  function buildCard(tplCard, item){
    const el = tplCard.content.cloneNode(true).children[0];
    el.dataset.code = item.code;
    el.querySelector('.title').textContent = item.name;
    el.querySelector('.code').textContent = `#${item.code}`;
    el.querySelector('.mod').textContent = item.mod || 'A';

    applyVisualState(el, getState(item.code));
    updateBlocked(el, item);

    el.addEventListener('click', (ev)=>{
      if(el.classList.contains('blocked')){
        toggleTip(el, true);
        return; // no permitir cambios si está bloqueada
      }
      const current = getState(item.code);
      const next = (current + 1) % 3; // 0->1->2->0

      if(current === 0 && next === 1){
        // quiere regularizar: chequear reg
        const missingReg = missingForRegular(item);
        if(missingReg.length){ return showBlocked(el, item, missingReg, []); }
      }
      if(current === 1 && next === 2){
        // quiere aprobar: chequear apr
        const missingApr = missingForApproved(item);
        if(missingApr.length){ return showBlocked(el, item, [], missingApr); }
      }
      setState(item.code, next);
      refreshAll();
    });

    el.addEventListener('mouseenter', ()=>{
      if(el.classList.contains('blocked')) toggleTip(el, true);
    });
    el.addEventListener('mouseleave', ()=>toggleTip(el,false));
    el.addEventListener('blur', ()=>toggleTip(el,false));

    return el;
  }

  function getState(code){ return state[code] ?? 0; }
  function setState(code, val){ state[code] = val; saveState(); }

  function applyVisualState(card, s){
    card.classList.remove('pending','regular','approved');
    let label = 'Pendiente';
    if(s===1){ card.classList.add('regular'); label = 'Regularizada'; }
    else if(s===2){ card.classList.add('approved'); label = 'Aprobada'; }
    else { card.classList.add('pending'); }
    card.querySelector('.state').textContent = label;
  }

  function courseByCode(code){
    return COURSES.find(x=>x.code===code) || ELECTIVES.find(x=>x.code===code);
  }

  function missingForRegular(item){
    return (item.reg||[]).filter(code => getState(code) < 1);
  }
  function missingForApproved(item){
    return (item.apr||[]).filter(code => getState(code) < 2);
  }

  function reasonText(item, missReg, missApr){
    const fmt = codes => codes.map(c=>`#${c} – ${courseByCode(c)?.name||'¿?'} (${stateLabel(getState(c))})`).join('\n');
    const lines = [];
    if(missReg.length){ lines.push('Para REGULARIZAR necesitas:\n' + fmt(missReg)); }
    if(missApr.length){ lines.push('Para APROBAR necesitas:\n' + fmt(missApr)); }
    return lines.join('\n\n');
  }
  function stateLabel(s){ return s===2?'Aprobada':(s===1?'Regularizada':'Pendiente'); }

  function updateBlocked(card, item){
    const s = getState(item.code);
    let blocked=false, tip='';
    if(s===0){
      const miss = missingForRegular(item);
      blocked = miss.length>0;
      tip = reasonText(item, miss, []);
    } else if(s===1){
      const miss = missingForApproved(item);
      blocked = miss.length>0; // bloquear sólo el pase a aprobada (pero permitimos mantener regular)
      tip = reasonText(item, [], miss);
    }
    card.classList.toggle('blocked', blocked);
    const tipEl = card.querySelector('.tooltip');
    tipEl.textContent = blocked ? tip : '';
    card.title = blocked ? tip.replaceAll('\n',' \u2022 ') : '';
  }

  function showBlocked(card, item, missReg, missApr){
    const tipEl = card.querySelector('.tooltip');
    tipEl.textContent = reasonText(item, missReg, missApr);
    card.classList.add('blocked');
    toggleTip(card,true);
  }
  function toggleTip(card, show){ card.classList.toggle('show-tip', !!show); }

  function refreshAll(){
    // Reaplica estado visual y bloqueo a todas las cartas
    document.querySelectorAll('.card').forEach(card=>{
      const code = +card.dataset.code;
      applyVisualState(card, getState(code));
      updateBlocked(card, courseByCode(code));
    });
  }

  // ============ Exportar / Importar / Reset ============
  document.getElementById('btnExport').addEventListener('click', ()=>{
    const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'malla-utn-frc-industrial-estado.json'; a.click();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
  });

  document.getElementById('importFile').addEventListener('change', (ev)=>{
    const file = ev.target.files?.[0]; if(!file) return;
    const reader = new FileReader();
    reader.onload = () => {
      try{
        const data = JSON.parse(String(reader.result));
        if(typeof data === 'object' && data){ state = data; saveState(); refreshAll(); }
      }catch(e){ alert('Archivo inválido. Debe ser JSON exportado desde esta malla.'); }
    };
    reader.readAsText(file);
  });

  document.getElementById('btnReset').addEventListener('click', ()=>{
    if(confirm('¿Seguro que deseas borrar todo tu progreso?')){
      state = {}; saveState(); refreshAll();
    }
  });

  // Inicializar
  render();

  </script>
</body>
</html>
